<!doctype html>
<html lang="zh-Hant">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ğŸ“¢ ç­ç´šå…¬å‘Šçœ‹æ¿</title>
  <style>
    html,
    body {
      margin: 0;
      background: #0f1624;
      color: #e9f2ff;
      font-family: system-ui, -apple-system, "Microsoft JhengHei", Segoe UI, Roboto, Arial
    }

    .wrap {
      display: flex;
      flex-direction: column;
      min-height: 100vh
    }

    header {
      padding: 10px 14px;
      background: #1e7bd8;
      color: #fff;
      display: flex;
      justify-content: space-between;
      align-items: center
    }

    main {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px
    }

    .card {
      max-width: 1100px;
      width: 100%;
      background: #0b1421;
      border: 1px solid #1c2a3e;
      border-radius: 18px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, .25);
      padding: 28px
    }

    #msg {
      font-size: 46px;
      line-height: 1.3;
      margin: 12px 0 16px 0;
      white-space: pre-wrap
    }

    #msg.fade-out {
      animation: msgFade .9s forwards
    }

    @keyframes msgFade {
      to {
        opacity: 0;
        visibility: hidden
      }
    }

    #msg.video-mode {
      font-size: 28px;
      color: #c8d6e5
    }

    #img {
      max-width: 100%;
      max-height: 60vh;
      display: none;
      border-radius: 12px;
      border: 1px solid #203049
    }

    #videoWrap {
      display: none;
      margin-top: 12px
    }

    #videoWrap iframe {
      width: 100%;
      height: 62vh;
      border: none;
      border-radius: 12px;
      background: #000
    }

    #videoHint {
      display: none;
      margin-top: 6px;
      font-size: 13px;
      color: #9fb6d1
    }

    .media-prompt {
      display: none;
      margin-top: 10px;
      padding: 10px 12px;
      border: 1px solid #24406a;
      border-radius: 10px;
      background: #132036;
      color: #e9f2ff;
      font-size: 14px
    }

    .media-prompt button {
      margin-top: 6px;
      border: none;
      border-radius: 8px;
      padding: 10px 14px;
      font-size: 15px;
      cursor: pointer;
      transition: all .15s ease;
      background: #1e7bd8;
      color: #fff
    }

    .media-prompt button:hover {
      filter: brightness(1.08);
      transform: translateY(-1px)
    }

    .media-prompt button:active {
      filter: brightness(.95);
      transform: translateY(0)
    }

    footer {
      padding: 10px 14px;
      color: #9fb6d1;
      font-size: 13px
    }

    #btnReinstall {
      margin-left: 10px;
      padding: 6px 10px;
      font-size: 13px;
      border: 1px solid #2c3d57;
      border-radius: 8px;
      background: #1e7bd8;
      color: #fff;
      cursor: pointer;
      transition: all .15s ease
    }

    #btnReinstall:hover {
      filter: brightness(1.08);
      transform: translateY(-1px)
    }

    #btnReinstall:active {
      filter: brightness(.95);
      transform: translateY(0)
    }

    /* åŒæ„å½ˆçª— */
    .consent-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, .6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999
    }

    .consent-box {
      background: #0b1421;
      border: 1px solid #1c2a3e;
      border-radius: 14px;
      padding: 20px;
      max-width: 520px;
      width: 92%;
      color: #e9f2ff;
      box-shadow: 0 12px 30px rgba(0, 0, 0, .35)
    }

    .consent-box h3 {
      margin: 0 0 10px 0;
      font-size: 20px
    }

    .consent-box p {
      margin: 6px 0;
      line-height: 1.5;
      font-size: 15px;
      color: #c8d6e5
    }

    .consent-actions {
      margin-top: 14px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap
    }

    .btn {
      border: none;
      border-radius: 8px;
      padding: 10px 14px;
      font-size: 15px;
      cursor: pointer;
      transition: all .15s ease;
      background: #1e7bd8;
      color: #fff
    }

    .btn.secondary {
      background: #223043;
      color: #c8d6e5
    }

    .btn:hover {
      filter: brightness(1.08);
      transform: translateY(-1px)
    }

    .btn:active {
      filter: brightness(.95);
      transform: translateY(0)
    }

    .consent-hint {
      font-size: 13px;
      color: #8aa0bb;
      margin-top: 6px
    }
  </style>
</head>

<body>

  <div class="wrap">
    <header>
      <div>ğŸ“¢ ç­ç´šå…¬å‘Šçœ‹æ¿</div>
      <div style="font-size:14px; display:flex; gap:12px;">
        <a href="index.html" style="color:#dff1ff; text-decoration:none;">ğŸ› ä¸»æ§å°</a>

        <a href="broadcast.html" style="color:#dff1ff; text-decoration:none;">ğŸ™ï¸ å»£æ’­</a>
        <a href="sched.html" style="color:#dff1ff; text-decoration:none;">ğŸ• æ’ç¨‹</a>
        <button id="btnFS"
          style="background:rgba(255,255,255,0.2); border:none; color:white; padding:4px 8px; border-radius:4px; cursor:pointer;">å…¨è¢å¹•</button>
      </div>
    </header>
    <main>
      <div class="card">
        <div id="msg">ï¼ˆç­‰å¾…å…¬å‘Šâ€¦ï¼‰</div>
        <img id="img" alt="å…¬å‘Šåœ–ç‰‡" />
        <div id="videoWrap"><iframe id="ytFrame" allow="autoplay; fullscreen" allowfullscreen></iframe></div>
        <div id="videoHint">è‹¥å½±ç‰‡ç„¡è²ï¼Œè«‹é»æ“Šæ’­æ”¾éµä¸¦è§£é™¤éœéŸ³ã€‚</div>
        <div id="mediaPrompt" class="media-prompt">
          å·²æ”¶åˆ°éŸ³è¨Š / å½±ç‰‡ï¼Œè«‹é»ã€Œæ’­æ”¾ã€é–‹å§‹ã€‚
          <div><button id="btnPlayMedia" type="button">æ’­æ”¾</button></div>
        </div>
        <audio id="audioPlayer" style="display:none;width:100%;margin-top:8px" controls></audio>
        <video id="videoPlayer" style="display:none;width:100%;max-height:62vh;margin-top:8px" controls></video>
      </div>
    </main>
    <footer>ç‹€æ…‹ï¼š<span id="stat">é€£ç·šä¸­â€¦</span> <button id="btnReinstall" type="button">é‡æ–°ä¸‹è¼‰å®‰è£å™¨</button></footer>
  </div>

  <script>
    /* ------------------------
       âœ… é˜²é‡è¤‡æ’­æ”¾ï¼šç‹€æ…‹è¨˜éŒ„
    ------------------------ */
    let lastMsg = "";
    let lastTs = 0;
    let lastEmbed = "";
    let lastMediaUrl = "";
    let lastMediaType = "";
    let lastImageUrl = "";
    let lastSound = 1;

    const API = (new URLSearchParams(location.search)).get("api") || location.origin;
    const INSTALLER_URL = "/static/setup/student_agent.exe"; // ä¸‹è¼‰å®‰è£å™¨è·¯å¾‘

    function toYoutubeEmbed(url, ts) {
      if (!url) return "";
      try {
        let videoId = "";
        const u = new URL(url);

        // Handle youtu.be/ID
        if (u.hostname.includes("youtu.be")) {
          videoId = u.pathname.slice(1);
        }
        // Handle youtube.com/watch?v=ID
        else if (u.pathname === "/watch") {
          videoId = u.searchParams.get("v");
        }
        // Handle youtube.com/embed/ID
        else if (u.pathname.startsWith("/embed/")) {
          videoId = u.pathname.split("/")[2];
        }
        // Handle youtube.com/shorts/ID
        else if (u.pathname.startsWith("/shorts/")) {
          videoId = u.pathname.split("/")[2];
        }
        // Handle youtube.com/live/ID
        else if (u.pathname.startsWith("/live/")) {
          videoId = u.pathname.split("/")[2];
        }

        // Clean up ID (remove extra params if dragged in path)
        if (videoId) {
          videoId = videoId.split('&')[0].split('?')[0];
        }

        if (videoId) {
          const suffix = `?autoplay=1&mute=1&playsinline=1&rel=0&controls=1&modestbranding=1&t=${ts || ""}`;
          return `https://www.youtube.com/embed/${videoId}${suffix}`;
        }
        return "";
      } catch (e) {
        // Fallback simple regex
        const m = url.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);
        if (m && m[1]) {
          const suffix = `?autoplay=1&mute=1&playsinline=1&rel=0&controls=1&modestbranding=1&t=${ts || ""}`;
          return `https://www.youtube.com/embed/${m[1]}${suffix}`;
        }
        return "";
      }
    }

    function speakIfNeeded(txt, on) {
      if (!on) return;
      if (!("speechSynthesis" in window)) return;

      try {
        const u = new SpeechSynthesisUtterance(txt);
        u.lang = "zh-TW";
        u.rate = 0.95;
        speechSynthesis.cancel();
        speechSynthesis.speak(u);
      } catch (e) { }
    }

    function applyState(st) {
      const msg = st.message || "";
      const ts = st.ts || 0;
      const media = st.media || st.media_url || "";
      const mediaType = (st.media_type || "").toLowerCase();
      const imageUrl = st.image || st.image_url || "";
      const rawVideo = st.video || st.yt || st.youtube || st.video_url || st.youtube_url || "";
      let ytUrl = rawVideo;
      if (!ytUrl) {
        const match = msg.match(/https?:\/\/[^\s]+/);
        if (match && (match[0].includes("youtube.com") || match[0].includes("youtu.be"))) {
          ytUrl = match[0];
        }
      }
      const tsForEmbed = ts ? Math.floor(Number(ts) / 1000) : 0;
      const embed = toYoutubeEmbed(ytUrl, tsForEmbed);
      const hasPayload = !!(msg || imageUrl || media || embed);
      if (!hasPayload) {
        // &#128229;&#128229;&#128229;&#128229;&#128229;&#128229;&#128229;&#128229;?
        return;
      }
      const soundFlag = (st.sound === 1 || st.sound === "1" || st.sound === true || st.sound === "true") ? 1 : 0;
      // å»é‡ï¼šæ–‡å­—/åœ–ç‰‡/å½±éŸ³/è²éŸ³æ——æ¨™/æ™‚é–“éƒ½ç›¸åŒæ‰ç•¥éï¼Œç¢ºä¿æœ‰è²/ç„¡è²åˆ‡æ›æœƒæ›´æ–°
      if (msg === lastMsg && imageUrl === lastImageUrl && embed === lastEmbed && media === lastMediaUrl && soundFlag === lastSound && ts === lastTs) {
        return;
      }
      let cleanedMsg = msg;
      if (embed) {
        // å»æ‰ä¸»ç¶²å€èˆ‡å…¶é¤˜æ®˜ç•™çš„ http(s) ç‰‡æ®µï¼Œé¿å…å¤§ç¶²å€ä½”ç‰ˆé¢
        cleanedMsg = cleanedMsg.replace(ytUrl || "", "");
        cleanedMsg = cleanedMsg.replace(/https?:\/\/\S+/g, "");
        cleanedMsg = cleanedMsg.trim();
        if (!cleanedMsg) cleanedMsg = "å½±ç‰‡æ’­æ”¾ä¸­";
      }
      // åˆ¤æ–·æ˜¯å¦ç‚ºç›´æ¥çš„ mp3/mp4 é€£çµ
      const isAudio = media && /\.(mp3|m4a|aac|wav|flac|ogg)$/i.test(media);
      const isVideo = media && /\.(mp4|mkv|mov|webm|m4v)$/i.test(media);

      const speakOn = soundFlag === 1;

      /* âœ… é˜²æ­¢é‡è¤‡æ’­æ”¾ï¼ˆæ–‡å­—ç›¸åŒ + ts ç›¸åŒ â†’ ä¸æ’­ï¼‰ */
      if (msg === lastMsg && ts === lastTs) {
        console.log("ğŸ” ç›¸åŒå…¬å‘Šï¼Œç•¥éæ’­æ”¾");
      } else {
        if (speakOn) {
          speakIfNeeded(msg, true);
        } else if ("speechSynthesis" in window) {
          try { speechSynthesis.cancel(); } catch (e) { }
        }
      }

      lastMsg = msg;
      lastTs = ts;

      // æ›´æ–°ç•«é¢
      const m = document.getElementById("msg");
      const img = document.getElementById("img");
      const vwrap = document.getElementById("videoWrap");
      const vframe = document.getElementById("ytFrame");
      const vhint = document.getElementById("videoHint");
      const audioEl = document.getElementById("audioPlayer");
      const videoEl = document.getElementById("videoPlayer");
      const mediaPrompt = document.getElementById("mediaPrompt");
      const btnPlayMedia = document.getElementById("btnPlayMedia");
      const hasMediaOnly = (!cleanedMsg) && (st.image || media || embed);
      m.classList.remove("fade-out");
      m.style.visibility = "";
      m.style.opacity = "";
      delete m.dataset.mediaPrompt;
      if (cleanedMsg) {
        m.textContent = cleanedMsg;
        m.style.display = "";
        m.style.fontSize = "";
      } else if (hasMediaOnly) {
        m.textContent = "æ”¶åˆ°åª’é«”ï¼Œè«‹é»ã€Œæ’­æ”¾ã€é–‹å§‹ã€‚";
        m.style.display = "";
        m.style.fontSize = "32px"; // Smaller prompt when only media is available
        m.dataset.mediaPrompt = "1";
      } else {
        m.textContent = "ï¼ˆç„¡è¨Šæ¯ï¼‰";
        m.style.display = "";
        m.style.fontSize = "";
      }

      if (st.image) {
        img.src = st.image + "?t=" + ts;
        img.style.display = "block";
      } else {
        img.removeAttribute("src");
        img.style.display = "none";
      }

      if (embed) {
        if (embed !== lastEmbed) {
          vframe.src = embed;
          lastEmbed = embed;
        }
        m.classList.add("video-mode");
        vwrap.style.display = "block";
        vhint.style.display = "block";
        audioEl.style.display = "none";
        videoEl.style.display = "none";
        mediaPrompt.style.display = "none";
        lastMediaUrl = "";
        lastMediaType = "";
      } else {
        if (lastEmbed) {
          vframe.removeAttribute("src");
          lastEmbed = "";
        }
        m.classList.remove("video-mode");
        vwrap.style.display = "none";
        vhint.style.display = "none";
        // è™•ç†ç›´æ¥çš„ mp3/mp4
        if (isAudio) {
          if (media !== lastMediaUrl || mediaType !== lastMediaType) {
            audioEl.src = media;
            lastMediaUrl = media;
            lastMediaType = mediaType || "audio";
            // Auto-play immediately
            audioEl.play().catch(e => console.log("Audio autoplay blocked:", e));
          }
          audioEl.style.display = "block";
          videoEl.style.display = "none";
          mediaPrompt.style.display = "none";
        } else if (isVideo) {
          if (media !== lastMediaUrl || mediaType !== lastMediaType) {
            videoEl.src = media;
            lastMediaUrl = media;
            lastMediaType = mediaType || "video";
            // Auto-play immediately
            videoEl.play().catch(e => console.log("Video autoplay blocked:", e));
          }
          videoEl.style.display = "block";
          audioEl.style.display = "none";
          mediaPrompt.style.display = "none";
        } else {
          audioEl.removeAttribute("src");
          videoEl.removeAttribute("src");
          audioEl.style.display = "none";
          videoEl.style.display = "none";
          mediaPrompt.style.display = "none";
          lastMediaUrl = "";
          lastMediaType = "";
        }
      }
      // è¨˜éŒ„æœ€æ–°ç‹€æ…‹é¿å…é‡è¤‡é‡ç¹ª
      lastMsg = msg;
      lastTs = ts;
      lastImageUrl = imageUrl;
      lastSound = soundFlag;
    }

    async function pullOnce() {
      try {
        const r = await fetch(API + "/announce_data", { cache: "no-store" });
        const j = await r.json();
        applyState(j);
        document.getElementById("stat").textContent = "å·²åŒæ­¥";
      }
      catch (e) {
        document.getElementById("stat").textContent = "é€£ç·šå¤±æ•—";
      }
    }

    function connectSSE() {
      const s = new EventSource(API + "/announce_sse");

      s.addEventListener("announce", (ev) => {
        try {
          applyState(JSON.parse(ev.data));
          document.getElementById("stat").textContent = "å·²æ›´æ–°";
        } catch (e) { }
      });

      s.onerror = () => {
        document.getElementById("stat").textContent = "SSE ä¸­æ–·ï¼Œæ”¹ç”¨è¼ªè©¢";
        s.close();
        setInterval(pullOnce, 3000);
      };
    }

    document.getElementById("btnFS").addEventListener("click", () => {
      const de = document.documentElement;
      if (de.requestFullscreen) de.requestFullscreen();
    });

    // æ‰‹å‹•æ’­æ”¾æç¤ºï¼šé¿å…ç€è¦½å™¨é˜»æ“‹è‡ªå‹•æ’­æ”¾
    document.getElementById("btnPlayMedia").addEventListener("click", () => {
      const audioEl = document.getElementById("audioPlayer");
      const videoEl = document.getElementById("videoPlayer");
      const mediaPrompt = document.getElementById("mediaPrompt");
      const msgEl = document.getElementById("msg");
      const tasks = [];
      if (videoEl.style.display !== "none" && videoEl.src) {
        tasks.push(videoEl.play());
      }
      if (audioEl.style.display !== "none" && audioEl.src) {
        tasks.push(audioEl.play());
      }
      Promise.allSettled(tasks).finally(() => {
        mediaPrompt.style.display = "none";
      });
      if (msgEl && msgEl.dataset.mediaPrompt === "1") {
        msgEl.classList.add("fade-out");
        setTimeout(() => {
          if (msgEl.classList.contains("fade-out")) {
            msgEl.style.display = "none";
          }
        }, 900);
      }
    });

    /* ------------------------
       ä½¿ç”¨è€…åŒæ„ + ä¸‹è¼‰å®‰è£å™¨
    ------------------------ */
    function showConsentIfNeeded() {
      // å…è¨±ä»¥ ?installed=1 æ¨™è¨˜å·²å®‰è£ï¼›?reset=1 å¯é‡ç½®æ——æ¨™ä»¥ä¾¿å†é¡¯ç¤º
      const params = new URLSearchParams(location.search);
      if (params.get("reset") === "1") {
        localStorage.removeItem("lan_broadcast_installed");
        localStorage.removeItem("lan_broadcast_consent");
      }
      if (params.get("installed") === "1") {
        localStorage.setItem("lan_broadcast_installed", "yes");
        return;
      }
      if (localStorage.getItem("lan_broadcast_installed") === "yes") return;

      const backdrop = document.createElement("div");
      backdrop.className = "consent-backdrop";
      backdrop.innerHTML = `
    <div class="consent-box">
      <h3>åŒæ„å®‰è£æ ¡å…§å»£æ’­æ¥æ”¶ç¨‹å¼</h3>
      <p>æ­¤ç¨‹å¼æœƒåœ¨èƒŒæ™¯è‡ªå‹•å°‹æ‰¾æ ¡å…§å»£æ’­ä¼ºæœå™¨ï¼Œä¸¦åœ¨æœ‰å…¬å‘Šæ™‚é¡¯ç¤º / æ’­å ±ã€‚å®‰è£å¾Œå°‡æ–¼é–‹æ©Ÿæ™‚è‡ªå‹•å•Ÿå‹•ã€‚</p>
      <p>è«‹ç¢ºèªæ‚¨åŒæ„ä»¥ä¸Šè¡Œç‚ºï¼Œä¸¦æ–¼ä¸‹è¼‰å¾Œè‡ªè¡ŒåŸ·è¡Œå®‰è£ç¨‹å¼ã€‚</p>
      <div class="consent-actions">
        <button id="btnAgree" class="btn">åŒæ„ä¸¦ä¸‹è¼‰</button>
        <button id="btnInstalled" class="btn secondary">æˆ‘å·²å®Œæˆå®‰è£</button>
        <button id="btnLater" class="btn secondary">ç¨å¾Œå†èªª</button>
      </div>
      <div class="consent-hint">ä¸‹è¼‰å®Œæˆå¾Œè«‹æ‰‹å‹•åŸ·è¡Œå®‰è£ç¨‹å¼ä»¥å•Ÿç”¨è‡ªå‹•å»£æ’­æ¥æ”¶ã€‚</div>
    </div>`;

      document.body.appendChild(backdrop);
      document.getElementById("btnAgree").onclick = () => {
        // é»æ“Šä¸‹è¼‰æ™‚è¦–ç‚ºå·²åŒæ„ï¼ˆä¸æ¨™è¨˜å·²å®‰è£ï¼Œæ–¹ä¾¿ç§»é™¤å¾Œèƒ½å†è§¸ç™¼ï¼‰
        localStorage.setItem("lan_broadcast_consent", "yes");
        window.location.href = INSTALLER_URL;
        backdrop.remove();
      };
      document.getElementById("btnInstalled").onclick = () => {
        // å­¸ç”Ÿç¢ºèªå·²å®‰è£å®Œï¼Œå¯æ‰‹å‹•é—œé–‰æç¤º
        localStorage.setItem("lan_broadcast_installed", "yes");
        localStorage.setItem("lan_broadcast_consent", "yes");
        backdrop.remove();
      };
      document.getElementById("btnLater").onclick = () => backdrop.remove();
    }

    window.addEventListener("load", () => {
      pullOnce();
      // ç«‹å³å•Ÿå‹•è¼ªè©¢ï¼Œç¢ºä¿å°±ç®— SSE ä¸å¯ç”¨ä¹Ÿèƒ½æŒçºŒæ›´æ–°
      setInterval(pullOnce, 3000);
      // å˜—è©¦ SSEï¼Œè‹¥å¤±æ•—æœƒè‡ªå‹• fallback ä¸Šé¢çš„è¼ªè©¢
      connectSSE();
      showConsentIfNeeded();
    });

    // æä¾›é‡ç½®ä¸‹è¼‰æç¤ºçš„è¼”åŠ©å‡½å¼ï¼ˆå¯åœ¨æ§åˆ¶å°å‘¼å« resetConsentPrompt()ï¼‰
    function resetConsentPrompt() {
      localStorage.removeItem("lan_broadcast_installed");
      localStorage.removeItem("lan_broadcast_consent");
      showConsentIfNeeded();
    }

    // é å°¾ã€Œé‡æ–°ä¸‹è¼‰å®‰è£å™¨ã€æŒ‰éˆ•ï¼šé‡ç½®æ——æ¨™ä¸¦å½ˆå‡ºåŒæ„ä¸‹è¼‰
    const btnRe = document.getElementById("btnReinstall");
    if (btnRe) {
      btnRe.addEventListener("click", () => {
        resetConsentPrompt();
      });
    }

  </script>

  <!-- â˜… æ–°å¢ï¼šè‡ªå‹•æ’­æ”¾è§£é–é®ç½© (ä»¿ç…§ student.html / watch.html) -->
  <style>
    #unlock-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 22, 36, 0.9);
      backdrop-filter: blur(4px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10000;
    }

    .unlock-box {
      text-align: center;
      background: #1c2a3e;
      padding: 30px;
      border-radius: 16px;
      border: 1px solid #2c3d57;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }

    .unlock-btn {
      background: #1e7bd8;
      color: #fff;
      border: none;
      padding: 12px 32px;
      font-size: 18px;
      border-radius: 50px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.2s;
      box-shadow: 0 4px 12px rgba(30, 123, 216, 0.4);
    }

    .unlock-btn:hover {
      background: #1976D2;
      transform: scale(1.05);
    }
  </style>

  <div id="unlock-overlay">
    <div class="unlock-box">
      <h2 style="margin-top:0; color:#fff;">ğŸ“¢ ç­ç´šå…¬å‘Šçœ‹æ¿</h2>
      <p style="color:#9fb6d1; margin-bottom:24px;">é»æ“Šä¸‹æ–¹æŒ‰éˆ•ä»¥å•Ÿç”¨è‡ªå‹•æ’­å ±åŠŸèƒ½</p>
      <button id="btnUnlock" class="unlock-btn">å•Ÿç”¨çœ‹æ¿</button>
    </div>
  </div>

  <script>
    (function () {
      const overlay = document.getElementById("unlock-overlay");
      const btn = document.getElementById("btnUnlock");

      function unlock() {
        // è§£é– SpeechSynthesis
        if ("speechSynthesis" in window) {
          speechSynthesis.cancel();
          const u = new SpeechSynthesisUtterance(" ");
          u.volume = 0;
          speechSynthesis.speak(u);
        }
        // è§£é– AudioContext (è‹¥æœ‰)
        const audio = document.getElementById("audioPlayer");
        if (audio) {
          audio.play().catch(() => { });
          audio.pause();
        }

        overlay.style.display = "none";
      }

      btn.addEventListener("click", unlock);

      // æª¢æŸ¥ URL autoplay åƒæ•¸
      const params = new URLSearchParams(location.search);
      if (params.get("autoplay") === "1") {
        // è‹¥æœ‰ autoplayï¼Œé¡¯ç¤ºé®ç½©è®“ Agent é»æ“Š (æˆ–ä½¿ç”¨è€…é»æ“Š)
        // [User Request] Disable popup warning (overlay)
        // overlay.style.display = "flex";
        console.log("Autoplay requested, but overlay disabled by user request.");

        // Try to auto-unlock without user interaction if possible (best effort)
        setTimeout(unlock, 500);
      }
    })();
  </script>

</body>

</html>