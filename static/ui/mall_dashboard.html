<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¢ RelayBell Premium | å•†å ´å»£æ’­ä¸»æ§å°</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Noto+Sans+TC:wght@300;400;700&display=swap');

        :root {
            --primary: #4f46e5;
            /* Indigo */
            --primary-light: #818cf8;
            --secondary: #ec4899;
            /* Pink */
            --accent: #f59e0b;
            /* Amber */
            --bg-main: #f8fafc;
            --bg-card: rgba(255, 255, 255, 0.85);
            --text-main: #1e293b;
            --text-muted: #64748b;
            --danger: #ef4444;
            --glass-border: rgba(255, 255, 255, 0.5);
            --shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.1), 0 8px 15px -6px rgba(0, 0, 0, 0.05);
            --neon-blue: #0ea5e9;
            --neon-purple: #8b5cf6;
        }

        body {
            font-family: 'Outfit', 'Noto Sans TC', sans-serif;
            background:
                linear-gradient(135deg, rgba(249, 168, 212, 0.2) 0%, rgba(199, 210, 254, 0.2) 50%, rgba(165, 243, 252, 0.2) 100%),
                #f8fafc;
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            overflow-x: hidden;
            background-attachment: fixed;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            animation: slideIn 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 40px;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid white;
            border-radius: 32px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            position: relative;
        }

        header::after {
            content: "";
            position: absolute;
            bottom: 0px;
            left: 15%;
            right: 15%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-light), var(--secondary), var(--neon-blue));
            border-radius: 3px 3px 0 0;
            opacity: 0.6;
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo-icon {
            width: 54px;
            height: 54px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: white;
            box-shadow: 0 8px 15px rgba(79, 70, 229, 0.25);
            animation: float 4s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-6px);
            }
        }

        .logo-text h1 {
            margin: 0;
            font-size: 1.7rem;
            font-weight: 800;
            color: #1e1b4b;
            letter-spacing: -0.5px;
        }

        .logo-text p {
            margin: 0;
            font-size: 0.85rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        .system-status {
            display: flex;
            gap: 15px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
            background: white;
            padding: 10px 22px;
            border-radius: 18px;
            border: 1px solid #e2e8f0;
            font-size: 0.95rem;
            font-weight: 600;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #10b981;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.2);
                opacity: 0.7;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 25px;
        }

        .card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid white;
            border-radius: 35px;
            padding: 30px;
            box-shadow: var(--shadow);
            transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.1);
        }

        h2 {
            margin-top: 0;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 25px;
            color: #1e293b;
            font-weight: 700;
        }

        /* Multilingual Presets */
        .col-presets {
            grid-column: span 8;
        }

        .col-settings {
            grid-column: span 4;
        }

        .col-manual {
            grid-column: span 12;
        }

        .col-sched {
            grid-column: span 12;
        }

        .presets-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .preset-item {
            background: #fff;
            border-radius: 28px;
            padding: 22px;
            border: 1px solid #f1f5f9;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.02);
            display: flex;
            flex-direction: column;
            gap: 15px;
            transition: 0.3s;
        }

        .preset-item:hover {
            border-color: var(--primary-light);
            background: #fdfdff;
        }

        .preset-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .preset-title {
            font-weight: 700;
            font-size: 1.1rem;
            color: #334155;
        }

        .pill {
            padding: 4px 12px;
            font-size: 0.7rem;
            background: #f1f5f9;
            border-radius: 8px;
            color: #64748b;
            font-weight: 700;
        }

        .preset-actions {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .btn-play {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            color: #1e293b;
            padding: 12px;
            border-radius: 18px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }

        .btn-play:hover {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-color: transparent;
            transform: scale(1.05);
            box-shadow: 0 10px 15px rgba(79, 70, 229, 0.2);
        }

        /* Manual TTS Area */
        .manual-area {
            display: flex;
            gap: 60px;
            /* Increased gap for better separation */
            align-items: flex-start;
        }

        .text-input-wrap {
            flex: 1;
            position: relative;
        }

        textarea {
            width: 100%;
            height: 85px;
            background: #fff;
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            padding: 12px 15px 40px 15px;
            color: #1e293b;
            font-family: inherit;
            font-size: 0.95rem;
            resize: none;
            transition: 0.3s;
        }

        textarea:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1);
        }

        .ai-assist-btn {
            position: absolute;
            right: 12px;
            bottom: 8px;
            background: linear-gradient(135deg, #4f46e5, #ec4899);
            border: none;
            color: white;
            padding: 6px 14px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 4px 8px rgba(79, 70, 229, 0.15);
            transition: 0.3s;
        }

        .ai-assist-btn:hover {
            transform: translateY(-2px) scale(1.03);
            filter: brightness(1.1);
        }

        .manual-controls {
            width: 280px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        select {
            background: #fff;
            border: 2px solid #e2e8f0;
            color: #334155;
            padding: 14px;
            border-radius: 16px;
            width: 100%;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-broadcast {
            background: linear-gradient(135deg, #10b981, #3b82f6);
            color: white;
            border: none;
            padding: 20px;
            border-radius: 22px;
            font-weight: 800;
            font-size: 1.2rem;
            cursor: pointer;
            transition: 0.3s;
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.2);
        }

        .btn-broadcast:hover {
            transform: scale(1.02);
            filter: brightness(1.05);
            box-shadow: 0 15px 30px rgba(16, 185, 129, 0.3);
        }

        /* Translation Preview Styles */
        .translation-preview-box {
            margin-top: 15px;
            background: rgba(239, 246, 255, 0.7);
            border: 1.5px dashed var(--primary-light);
            border-radius: 18px;
            padding: 16px;
            backdrop-filter: blur(10px);
            animation: fadeInDown 0.4s ease;
            position: relative;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .preview-title {
            font-size: 0.85rem;
            color: var(--primary);
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .preview-body {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #1e3a8a;
            font-style: italic;
            word-break: break-all;
        }

        .apply-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 5px 14px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 700;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .apply-btn:hover {
            background: var(--primary-light);
            transform: translateY(-1px);
        }

        .discard-btn {
            background: #f1f5f9;
            color: #64748b;
            border: none;
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 0.75rem;
            cursor: pointer;
        }

        /* Schedule List */
        .sched-table-wrap {
            overflow-x: auto;
            margin-top: 10px;
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 12px;
        }

        th {
            text-align: left;
            padding: 15px;
            color: var(--text-muted);
            font-weight: 700;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        td {
            padding: 22px 18px;
            background: white;
            border-top: 1px solid #f1f5f9;
            border-bottom: 1px solid #f1f5f9;
        }

        td:first-child {
            border-left: 1px solid #f1f5f9;
            border-top-left-radius: 24px;
            border-bottom-left-radius: 24px;
        }

        td:last-child {
            border-right: 1px solid #f1f5f9;
            border-top-right-radius: 24px;
            border-bottom-right-radius: 24px;
        }

        .time-badge {
            background: #eef2ff;
            color: var(--primary);
            padding: 8px 16px;
            border-radius: 12px;
            font-family: 'Outfit';
            font-size: 1.15rem;
            font-weight: 800;
        }

        .btn-icon {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            color: #334155;
            width: 44px;
            height: 44px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.3s;
        }

        .btn-icon:hover {
            background: #fee2e2;
            color: #ef4444;
            border-color: #fecaca;
            transform: rotate(8deg);
        }

        /* Switches */
        .switch {
            position: relative;
            display: inline-block;
            width: 56px;
            height: 30px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #e2e8f0;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 24px;
            width: 24px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        input:checked+.slider {
            background: linear-gradient(135deg, #10b981, #3b82f6);
        }

        input:checked+.slider:before {
            transform: translateX(26px);
        }

        .btn-stop {
            grid-column: span 12;
            background: #fff1f2;
            border: 2px dashed #fecaca;
            color: #e11d48;
            padding: 18px;
            border-radius: 24px;
            font-weight: 800;
            cursor: pointer;
            margin-top: 10px;
            transition: 0.3s;
        }

        .btn-stop:hover {
            background: #e11d48;
            color: white;
            border-style: solid;
            box-shadow: 0 10px 20px rgba(225, 29, 72, 0.2);
        }

        .vibrant-gradient-text {
            background: linear-gradient(135deg, #4f46e5, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    </style>
</head>

<body>

    <div class="container">
        <!-- Dashboard Header -->
        <header>
            <div class="logo-area">
                <div class="logo-icon">ğŸ¢</div>
                <div class="logo-text">
                    <h1><span class="vibrant-gradient-text">RelayBell</span> Premium</h1>
                    <p>Professional Mall Intelligence Console</p>
                </div>
            </div>

            <div class="system-status">
                <div class="status-item">
                    <a href="index.html" style="color: inherit; text-decoration: none;">ğŸ  <span
                            style="margin-left:5px">Home</span></a>
                </div>
                <div class="status-item">
                    <div class="dot"></div>
                    <span id="currentTime">--:--:--</span>
                </div>
                <div class="status-item">
                    <span style="color:var(--primary)">Next:</span>
                    <span id="nextSchedInfo" style="font-weight:700">--:--</span>
                </div>
            </div>
        </header>

        <div class="grid">
            <!-- Left Side: Presets -->
            <div class="card col-presets">
                <h2>
                    <span style="font-size: 1.8rem">ğŸ“¢</span> å¤šåœ‹èªè¨€é€Ÿæ§ (Voice Presets)
                </h2>
                <div class="presets-grid">
                    <!-- Opening -->
                    <div class="preset-item">
                        <div class="preset-header">
                            <span class="preset-title">ğŸŒ… é–‹åº—å„€å¼ (Opening)</span>
                            <div class="lang-pills">
                                <span class="pill">ZH</span><span class="pill">EN</span><span class="pill">JA</span>
                            </div>
                        </div>
                        <div class="preset-actions">
                            <button class="btn-play" onclick="speakPreset('zh_opening')">ğŸ‡¹ğŸ‡¼ ä¸­æ–‡</button>
                            <button class="btn-play" onclick="speakPreset('en_opening')">ğŸ‡ºğŸ‡¸ English</button>
                            <button class="btn-play" onclick="speakPreset('ja_opening')">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</button>
                            <button class="btn-play" onclick="speakPreset('ko_opening')">ğŸ‡°ğŸ‡· í•œêµ­ì–´</button>
                        </div>
                    </div>

                    <!-- Closing -->
                    <div class="preset-item">
                        <div class="preset-header">
                            <span class="preset-title">ğŸŒ™ é–‰åº—å»£æ’­ (Closing)</span>
                            <div class="lang-pills">
                                <span class="pill">ZH</span><span class="pill">EN</span><span class="pill">JA</span>
                            </div>
                        </div>
                        <div class="preset-actions">
                            <button class="btn-play" onclick="speakPreset('zh_closing')">ğŸ‡¹ğŸ‡¼ ä¸­æ–‡</button>
                            <button class="btn-play" onclick="speakPreset('en_closing')">ğŸ‡ºğŸ‡¸ English</button>
                            <button class="btn-play" onclick="speakPreset('ja_closing')">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</button>
                            <button class="btn-play" onclick="speakPreset('ko_closing')">ğŸ‡°ğŸ‡· í•œêµ­ì–´</button>
                        </div>
                    </div>

                    <!-- Lost Child -->
                    <div class="preset-item">
                        <div class="preset-header">
                            <span class="preset-title">ğŸ‘¦ å°‹äººå•Ÿäº‹ (Lost Person)</span>
                            <div class="lang-pills">
                                <span class="pill">4-LANG</span>
                            </div>
                        </div>
                        <div class="preset-actions">
                            <button class="btn-play" onclick="speakPreset('zh_lost')">ğŸ‡¹ğŸ‡¼ ä¸­æ–‡</button>
                            <button class="btn-play" onclick="speakPreset('en_lost')">ğŸ‡ºğŸ‡¸ English</button>
                            <button class="btn-play" onclick="speakPreset('ja_lost')">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</button>
                            <button class="btn-play" onclick="speakPreset('ko_lost')">ğŸ‡°ğŸ‡· í•œêµ­ì–´</button>
                        </div>
                    </div>

                    <!-- Promotion -->
                    <div class="preset-item">
                        <div class="preset-header">
                            <span class="preset-title">ğŸˆ æ´»å‹•ä¿ƒéŠ· (Promotion)</span>
                            <div class="lang-pills">
                                <span class="pill">ZH</span><span class="pill">EN</span>
                            </div>
                        </div>
                        <div class="preset-actions">
                            <button class="btn-play" onclick="speakPreset('zh_sale')">ğŸ‡¹ğŸ‡¼ ä¸­æ–‡</button>
                            <button class="btn-play" onclick="speakPreset('en_sale')">ğŸ‡ºğŸ‡¸ English</button>
                            <button class="btn-play" onclick="speakPreset('ja_sale')">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</button>
                            <button class="btn-play" onclick="speakPreset('ko_sale')">ğŸ‡°ğŸ‡· í•œêµ­ì–´</button>
                        </div>
                    </div>
                </div>

                <button class="btn-stop" onclick="stopAll()">â›” åœæ­¢ç•¶å‰æ‰€æœ‰æ’­æ”¾ (EMERGENCY STOP)</button>
            </div>

            <!-- Right Side: Quick Settings -->
            <div class="card col-settings">
                <h2><span style="font-size: 1.8rem">âš™ï¸</span> ç³»çµ±æ§åˆ¶ (Control)</h2>

                <div class="settings-row" style="margin-bottom: 5px;">
                    <span style="font-weight:700; color:#475569">ç³»çµ±éŸ³é‡ (Master Vol)</span>
                    <span id="volVal" style="font-weight:800; color:var(--primary); font-size:1.3rem">80%</span>
                </div>
                <div style="padding: 10px 0 25px 0;">
                    <input type="range" id="volSlider" min="0" max="100" value="80" oninput="updateVol(this.value)">
                </div>

                <div class="settings-row">
                    <span style="font-weight:600">æ“´å¤§æ©Ÿé€£å‹• (Auto Amp)</span>
                    <label class="switch">
                        <input type="checkbox" id="ampToggle" onchange="toggleAmp(this.checked)">
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="settings-row" style="margin-bottom: 35px;">
                    <span style="font-weight:600">æ’­æ”¾å‰å°éŸ³ (Chime)</span>
                    <label class="switch">
                        <input type="checkbox" id="chimeToggle" onchange="toggleChime(this.checked)" checked>
                        <span class="slider"></span>
                    </label>
                </div>

                <div style="margin-top: 10px; border-top: 2px solid #f1f5f9; padding-top: 30px;">
                    <h3 style="font-size:1rem; margin-bottom:15px; color:var(--text-muted)">âš¡ å¿«æ·éŸ³æ•ˆ (Shortcuts)</h3>
                    <div class="preset-actions" style="grid-template-columns: 1fr 1fr;">
                        <button class="btn-play" style="flex-direction:row; padding:15px; gap:10px"
                            onclick="postCmd('Bell:ClassStart')">ğŸ”” æç¤º A</button>
                        <button class="btn-play" style="flex-direction:row; padding:15px; gap:10px"
                            onclick="postCmd('Bell:ClassEnd')">ğŸ”” æç¤º B</button>
                    </div>
                </div>
            </div>

            <!-- Bottom: Manual TTS -->
            <div class="card col-manual" style="position: relative;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h2><span style="font-size: 1.8rem">ğŸ™ï¸</span> å³æ™‚äººå·¥æ’­å ± (Live Console)</h2>
                    <div id="broadcastStatus"
                        style="display: flex; align-items: center; gap: 10px; background: #ecfdf5; border: 1px solid #10b981; padding: 8px 20px; border-radius: 99px; color: #065f46; font-weight: 700; font-size: 0.9rem;">
                        <div class="dot" style="background: #10b981;"></div> SYSTEM READY (ON-AIR)
                    </div>
                </div>
                <div class="manual-area">
                    <div style="flex: 1; display: flex; flex-direction: column;">
                        <div class="text-input-wrap">
                            <textarea id="manualContent" placeholder="æ’­å ±å…§å®¹..."
                                oninput="updateCharCount(this.value)"></textarea>
                            <div
                                style="position: absolute; left: 15px; bottom: 10px; font-size: 0.75rem; color: var(--text-muted); font-weight: 600;">
                                <span id="charCount" style="color: var(--primary)">0</span> / 500
                            </div>
                            <button class="ai-assist-btn" onclick="generateAIScript()">
                                <span>âœ¨</span> AI æ™ºèƒ½æ’°ç¨¿
                            </button>
                        </div>

                        <!-- [NEW] Translation Preview Area -->
                        <div id="transPreview" class="translation-preview-box" style="display: none;">
                            <div class="preview-header">
                                <span class="preview-title">ğŸŒ ç¿»è­¯é è¦½ (èˆ‡åŸç¨¿æ ¸å°)</span>
                                <div style="display: flex; gap: 8px;">
                                    <button class="discard-btn" onclick="discardTranslation()">âœ–ï¸ é—œé–‰</button>
                                    <button class="apply-btn" style="background:#f59e0b"
                                        onclick="auditionPreviewContent()">ğŸ§ è©¦è½</button>
                                    <button class="apply-btn" style="background:#ef4444" onclick="stopAudition()">â¹
                                        åœæ­¢</button>
                                    <button class="apply-btn" id="btn-broadcast-preview" onclick="speakTranslation()">ğŸš€
                                        å»£æ’­</button>
                                </div>
                            </div>
                            <div id="transPreviewText" class="preview-body"></div>
                        </div>
                    </div>
                    <div class="manual-controls">
                        <div
                            style="background: #f8fafc; padding: 22px; border-radius: 25px; border: 1px solid #e2e8f0; display: flex; flex-direction: column; gap: 15px;">
                            <div style="display:flex; justify-content:space-between; align-items:center">
                                <label style="font-size: 0.9rem; color: #475569; font-weight:700">å»£æ’­èªç³»</label>
                                <span class="pill" id="langTag"
                                    style="background:var(--primary); color:white">ZH-TW</span>
                            </div>
                            <select id="manualLang"
                                onchange="document.getElementById('langTag').innerText = this.value.toUpperCase()">
                                <option value="auto">è‡ªå‹•åµæ¸¬ (Auto)</option>
                                <option value="zh-TW">ä¸­æ–‡ (Mandarin)</option>
                                <option value="en-US">è‹±æ–‡ (English)</option>
                                <option value="ja-JP">æ—¥æ–‡ (Japanese)</option>
                                <option value="ko-KR">éŸ“æ–‡ (Korean)</option>
                                <option value="vi-VN">è¶Šå—èª (Vietnamese)</option>
                                <option value="km-KH">æŸ¬åŸ”å¯¨/é«˜æ£‰ (Khmer)</option>
                                <option value="lo-LA">å¯®åœ‹ (Lao)</option>
                                <option value="th-TH">æ³°æ–‡ (Thai)</option>
                                <option value="my-MM">ç·¬ç”¸ (Myanmar)</option>
                                <option value="ms-MY">é¦¬ä¾†è¥¿äº (Malay)</option>
                                <option value="id-ID">å°å°¼èª (Indonesian)</option>
                                <option value="tl-PH">è²å¾‹è³“ (Filipino)</option>
                                <option value="nan-TW">å°èª (Hokkien)</option>
                            </select>

                            <label style="font-size: 0.9rem; color: #475569; font-weight:700">è²å„ªé¢¨æ ¼</label>
                            <select id="manualGender">
                                <option value="female">æº«æŸ”å¥³è² (Standard)</option>
                                <option value="male">å°ˆæ¥­ç”·è² (Professional)</option>
                            </select>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <button class="btn-play" style="height: 55px; border-radius: 20px; font-weight:700"
                                onclick="translateAndFill(event)">ğŸŒ æ™ºæ…§ç¿»è­¯</button>
                            <div style="display:flex; gap:5px;">
                                <button class="btn-play"
                                    style="flex:1; height: 55px; border-radius: 20px; font-weight:700"
                                    onclick="auditionMainContent()">ğŸ§ è©¦è½</button>
                                <button class="btn-play"
                                    style="width: 50px; height: 55px; border-radius: 20px; font-weight:700; color:#ef4444;"
                                    onclick="stopAudition()">â¹</button>
                            </div>
                        </div>
                        <button class="btn-broadcast" onclick="broadcastNow()"
                            style="height: 75px; font-size: 1.4rem; letter-spacing: 2px;">
                            ğŸš€ ç«‹å³å»£æ’­
                        </button>
                    </div>
                </div>
            </div>

            <!-- Bottom: Schedule Management -->
            <div class="card col-sched">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h2><span style="font-size: 1.8rem">ğŸ“…</span> å®šæ™‚å»£æ’­æ’ç¨‹ (Smart Scheduler)</h2>
                    <button class="ai-assist-btn" style="position:static; background:#594dff"
                        onclick="openSchedModal()">
                        â• æ–°å¢å®šæ™‚æ’­å ±
                    </button>
                </div>
                <div class="sched-table-wrap">
                    <table>
                        <thead>
                            <tr>
                                <th>å•Ÿç”¨</th>
                                <th>åŸ·è¡Œæ™‚é–“</th>
                                <th>å¾ªç’°é€±æœŸ</th>
                                <th>æ¨™é¡Œèˆ‡å…§å®¹é è¦½</th>
                                <th style="text-align:right">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="schedList">
                            <tr>
                                <td colspan="5" style="text-align:center; padding:60px; color:var(--text-muted)">ğŸ›¸
                                    æ­£åœ¨åŒæ­¥é›²ç«¯èˆ‡æœ¬åœ°æ’ç¨‹...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="schedModal" class="modal">
        <div class="modal-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px">
                <h3 style="margin:0; font-size:1.6rem; font-weight:800">å»ºç«‹å®šæ™‚å»£æ’­</h3>
                <span style="font-size:32px; cursor:pointer; color:var(--text-muted)"
                    onclick="closeSchedModal()">&times;</span>
            </div>
            <div style="display: flex; flex-direction: column; gap: 20px;">
                <div>
                    <label style="display:block; margin-bottom:10px; font-weight:700">ä»»å‹™ç°¡ç¨±</label>
                    <input type="text" id="m-title" placeholder="ä¾‹å¦‚ï¼šæ¯æ—¥å¿«é–ƒç‰¹è³£">
                </div>
                <div>
                    <label style="display:block; margin-bottom:10px; font-weight:700">æ™‚é–“ è¨­å®š</label>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <input type="number" id="m-hh" min="0" max="23" value="10" style="padding:15px"> :
                        <input type="number" id="m-mm" min="0" max="59" value="00" style="padding:15px"> :
                        <input type="number" id="m-ss" min="0" max="59" value="00" style="padding:15px">
                    </div>
                </div>
                <div>
                    <label style="display:block; margin-bottom:10px; font-weight:700">é‡è¤‡ é€±æœŸ</label>
                    <div id="m-days" style="display: flex; gap: 12px; flex-wrap: wrap;">
                        <label><input type="checkbox" value="1" checked> ä¸€</label>
                        <label><input type="checkbox" value="2" checked> äºŒ</label>
                        <label><input type="checkbox" value="3" checked> ä¸‰</label>
                        <label><input type="checkbox" value="4" checked> å››</label>
                        <label><input type="checkbox" value="5" checked> äº”</label>
                        <label><input type="checkbox" value="6"> å…­</label>
                        <label><input type="checkbox" value="7"> æ—¥</label>
                    </div>
                </div>
                <button class="btn-broadcast" onclick="saveNewSched()" style="margin-top:15px">ğŸ’¾ ç¢ºèªå„²å­˜ä»»å‹™</button>
            </div>
        </div>
    </div>

    <audio id="preview-player" style="display:none"></audio>
    <script>
        const API_BASE = (location.port === '5050' || location.port === '5000') ? '' : 'http://localhost:5050';

        const PRESETS = {
            'zh_opening': { text: 'å„ä½è²´è³“æ‚¨å¥½ï¼Œæ­¡è¿å…‰è‡¨ã€‚ä»Šæ—¥ç‡Ÿæ¥­æ™‚é–“å³å°‡é–‹å§‹ï¼Œç¥æ‚¨è³¼ç‰©æ„‰å¿«ã€‚', lang: 'zh-TW' },
            'en_opening': { text: 'Welcome! Our doors are now open. We wish you a wonderful shopping experience.', lang: 'en-US' },
            'ja_opening': { text: 'ãŠå®¢æ§˜ã€æœ¬æ—¥ã¯ã”æ¥åº—ã„ãŸã ãã€èª ã«ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚é–“ã‚‚ãªãé–‹åº—ã„ãŸã—ã¾ã™ã€‚', lang: 'ja-JP' },
            'ko_opening': { text: 'ì†ë‹˜ ì—¬ëŸ¬ë¶„, ì•ˆë…•í•˜ì‹­ë‹ˆê¹Œ. ì§€ê¸ˆë¶€í„° ì˜ì—…ì„ ì‹œì‘í•˜ì˜¤ë‹ˆ ì¦ê±°ìš´ ì‡¼í•‘ ë˜ì‹œê¸° ë°”ëë‹ˆë‹¤.', lang: 'ko-KR' },
            'zh_closing': { text: 'æ„Ÿè¬æ‚¨çš„å…‰è‡¨ï¼Œæœ¬å•†å ´å°‡æ–¼ä¸‰ååˆ†é˜å¾ŒçµæŸä»Šæ—¥ç‡Ÿæ¥­ï¼Œè«‹æ‚¨ç•™æ„æ™‚é–“ä¸¦è‡³æ«ƒå°çµå¸³ã€‚', lang: 'zh-TW' },
            'en_closing': { text: 'The mall will be closing in 30 minutes. Please proceed to the checkout. Thank you!', lang: 'en-US' },
            'ja_closing': { text: 'å½“åº—ã¯ã‚ã¨30åˆ†ã§é–‰åº—ã„ãŸã—ã¾ã™ã€‚ãŠè²·ã„å¿˜ã‚Œã®ãªã„ã‚ˆã†ã”æ³¨æ„ãã ã•ã„ã€‚', lang: 'ja-JP' },
            'ko_closing': { text: 'ì €í¬ ì‡¼í•‘ëª°ì€ 30ë¶„ í›„ ì˜ì—…ì„ ì¢…ë£Œí•  ì˜ˆì •ì…ë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤.', lang: 'ko-KR' },
            'zh_lost': { text: 'å„ä½è²´è³“è«‹æ³¨æ„ï¼Œç›®å‰æœ‰ä¸€ä½å°æœ‹å‹æ–¼æœå‹™å°å°‹æ‰¾å®¶é•·ï¼Œè«‹æœ‰çœ·å±¬èµ°å¤±çš„è²´è³“ç«‹å³å‰å¾€ã€‚', lang: 'zh-TW' },
            'en_lost': { text: 'Attention. We have a lost child at the information desk. Please come to the desk immediately.', lang: 'en-US' },
            'ja_lost': { text: 'è¿·å­ã®ãŠå­æ§˜ã‚’æœå‹™å°ã§ãŠé ã‹ã‚Šã—ã¦ãŠã‚Šã¾ã™ã€‚ãŠå¿ƒå½“ãŸã‚Šã®æ–¹ã¯ãŠè¶Šã—ãã ã•ã„ã€‚', lang: 'ja-JP' },
            'ko_lost': { text: 'ë¶€ëª¨ë‹˜ì„ ì°¾ëŠ” ì–´ë¦°ì´ê°€ ì„œë¹„ìŠ¤ ë°ìŠ¤í¬ì— ìˆìŠµë‹ˆë‹¤. í™•ì¸ ë¶€íƒë“œë¦½ë‹ˆë‹¤.', lang: 'ko-KR' },
            'zh_sale': { text: 'é™æ™‚ç‰¹è³£å¿«å ±ï¼å¤šæ¬¾ç†±é–€å•†å“ç¾æ­£èˆ‰è¾¦è¶…ä½æŠ˜æ‰£ç‰¹è³£ï¼Œåé¡æœ‰é™ï¼Œæ­¡è¿é¸è³¼ã€‚', lang: 'zh-TW' },
            'en_sale': { text: 'Flash Sale! Selected items are now up to 50% off. Hurry, limited quantities!', lang: 'en-US' },
            'ja_sale': { text: 'ã‚¿ã‚¤ãƒ ã‚»ãƒ¼ãƒ«é–‹å‚¬ä¸­ï¼äººæ°—å•†å“ãŒç‰¹åˆ¥ä¾¡æ ¼ã§ã™ã€‚ãœã²ãŠç«‹ã¡å¯„ã‚Šãã ã•ã„ã€‚', lang: 'ja-JP' },
            'ko_sale': { text: 'íƒ€ì„ ì„¸ì¼ ì•ˆë‚´! ì¸ê¸° ìƒí’ˆì„ íŒŒê²©ì ì¸ í• ì¸ê°€ë¡œ ë§Œë‚˜ë³´ì„¸ìš”.', lang: 'ko-KR' }
        };

        function $(id) { return document.getElementById(id); }

        function updateClock() { $('currentTime').innerText = new Date().toLocaleTimeString(); }
        setInterval(updateClock, 1000); updateClock();

        async function speakPreset(key) {
            const data = PRESETS[key];
            if (data) doSpeak(data.text, data.lang, 'female');
        }

        async function broadcastNow() {
            const text = $('manualContent').value.trim();
            const lang = $('manualLang').value;
            const gender = $('manualGender').value;
            if (!text) return alert('è«‹è¼¸å…¥å…§å®¹');
            doSpeak(text, lang, gender);
        }

        async function doSpeak(text, lang, gender) {
            try {
                const res = await fetch(`${API_BASE}/api/speak_v2`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text, lang, gender })
                });
                const data = await res.json();
                if (!data.ok) alert('éŒ¯èª¤: ' + data.error);
            } catch (e) { }
        }

        async function translateAndFill(event) {
            const text = $('manualContent').value.trim();
            const target = $('manualLang').value.split('-')[0];
            if (!text) return alert('è«‹å…ˆè¼¸å…¥è¦ç¿»è­¯çš„å…§å®¹');

            const btn = event.target;
            const oldText = btn.innerText;
            btn.innerText = 'âŒ› ç¿»è­¯ä¸­...';
            btn.disabled = true;

            try {
                const res = await fetch(`${API_BASE}/translate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ q: text, target: target, source: 'auto' })
                });

                if (!res.ok) throw new Error(`HTTP éŒ¯èª¤: ${res.status}`);

                const data = await res.json();
                if (data.ok) {
                    // Show in preview for verification instead of direct overwrite
                    $('transPreviewText').innerText = data.translatedText;
                    $('transPreview').style.display = 'block';

                    // Pulse animation
                    $('transPreview').style.animation = 'none';
                    $('transPreview').offsetHeight;
                    $('transPreview').style.animation = 'fadeInDown 0.4s ease';
                } else {
                    alert('ç¿»è­¯å¤±æ•—: ' + (data.error || 'ä½çŸ¥éŒ¯èª¤'));
                }
            } catch (e) {
                alert('ç¿»è­¯è«‹æ±‚ç™¼ç”ŸéŒ¯èª¤: ' + e.message);
            } finally {
                btn.innerText = oldText;
                btn.disabled = false;
            }
        }

        async function speakTranslation() {
            const text = $('transPreviewText').innerText;
            const lang = $('manualLang').value;
            const gender = $('manualGender').value;

            if (text) {
                // Keep the box, but change button to show success
                const applyBtn = $('btn-broadcast-preview');
                if (applyBtn) {
                    const oldHtml = applyBtn.innerHTML;
                    applyBtn.innerHTML = 'ğŸ”Š æ­£åœ¨æ’­æ”¾...';
                    applyBtn.style.background = '#10b981'; // Green

                    await doSpeak(text, lang, gender);

                    setTimeout(() => {
                        applyBtn.innerHTML = oldHtml;
                        applyBtn.style.background = '';
                    }, 2000);
                } else {
                    await doSpeak(text, lang, gender);
                }
            }
        }

        function auditionPreviewContent() {
            const text = $('transPreviewText').innerText;
            const lang = $('manualLang').value;
            const gender = $('manualGender').value;
            if (text) auditionText(text, lang, gender);
        }

        function discardTranslation() {
            $('transPreview').style.display = 'none';
        }

        async function generateAIScript() {
            const keyword = $('manualContent').value.trim();
            if (!keyword) return alert('è«‹è¼¸å…¥ä¿ƒéŠ·ä¸»é¡Œ');
            const btn = document.querySelector('.ai-assist-btn');
            btn.innerHTML = 'âœ¨ AI å¥®åŠ›æ’°å¯«ä¸­...';
            try {
                const res = await fetch(`${API_BASE}/api/ai_script`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ keyword: keyword })
                });
                const data = await res.json();
                if (data.ok) $('manualContent').value = data.script;
            } finally { btn.innerHTML = 'âœ¨ AI æ’°å¯«å»£æ’­ç¨¿'; }
        }

        async function updateVol(val) {
            $('volVal').innerText = val + '%';
            const params = new URLSearchParams(); params.append('vol', val);
            fetch(`${API_BASE}/setvol`, { method: 'POST', body: params });
        }

        function toggleAmp(enabled) {
            fetch(`${API_BASE}/api/relay_config`, {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ auto_on: enabled })
            });
        }

        function toggleChime(enabled) {
            fetch(`${API_BASE}/api/set_chime_config`, {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ enabled: enabled })
            });
        }

        function postCmd(cmd) {
            const params = new URLSearchParams(); params.append('cmd', cmd);
            fetch(`${API_BASE}/cmd`, { method: 'POST', body: params });
        }

        function stopAll() { postCmd('CancelALL'); stopAudition(); }

        let schedules = [];
        async function loadSchedules() {
            try {
                const res = await fetch(`${API_BASE}/schedules`, { cache: 'no-store' });
                const data = await res.json();
                schedules = Array.isArray(data) ? data : (data.items || []);
                renderSchedules();
                updateNextSched();
            } catch (e) { }
        }

        function renderSchedules() {
            const tbody = $('schedList');
            if (schedules.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding:60px">â˜• ç›®å‰æš«ç„¡ä»»ä½•æ’ç¨‹ä»»å‹™</td></tr>';
                return;
            }
            tbody.innerHTML = '';
            schedules.forEach(s => {
                const tr = document.createElement('tr');
                const daysMap = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'æ—¥'];
                const daysText = (s.days || []).map(d => daysMap[d]).join(',');
                tr.innerHTML = `
                    <td><label class="switch"><input type="checkbox" ${s.enabled ? 'checked' : ''} onchange="toggleSchedStatus('${s.id}', this.checked)"><span class="slider"></span></label></td>
                    <td><span class="time-badge">${s.time}</span></td>
                    <td>${daysText || 'å–®æ¬¡'}</td>
                    <td><div style="font-weight:700; color:#1e293b">${s.title}</div><div style="font-size:0.85rem; color:var(--text-muted)">${s.payload.substring(0, 60)}...</div></td>
                    <td style="text-align:right">
                        <div style="display:flex; gap:10px; justify-content:flex-end">
                            <button class="btn-icon" style="color:#10b981" onclick="trySched('${s.id}')">â–¶ï¸</button>
                            <button class="btn-icon" style="color:#ef4444" onclick="deleteSched('${s.id}')">ğŸ—‘ï¸</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        async function updateNextSched() {
            try {
                const res = await fetch(`${API_BASE}/schedules/status`);
                const data = await res.json();
                $('nextSchedInfo').innerText = data.has_next ? `${data.next.time}` : 'None';
            } catch (e) { }
        }

        function openSchedModal() { $('m-content'); $('schedModal').style.display = 'flex'; }
        function closeSchedModal() { $('schedModal').style.display = 'none'; }

        async function saveNewSched() {
            const text = $('manualContent').value;
            const hh = $('m-hh').value.padStart(2, '0');
            const mm = $('m-mm').value.padStart(2, '0');
            const ss = $('m-ss').value.padStart(2, '0');
            const newSched = {
                id: 's_' + Date.now(),
                title: $('m-title').value || 'æ–°ä»»å‹™',
                time: `${hh}:${mm}:${ss}`,
                days: Array.from($('m-days').querySelectorAll('input:checked')).map(i => parseInt(i.value)),
                type: 'send',
                payload: text || 'æ¸¬è©¦',
                enabled: true
            };
            schedules.push(newSched); await pushSchedules(); closeSchedModal();
        }

        async function pushSchedules() {
            await fetch(`${API_BASE}/schedules`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(schedules)
            });
            loadSchedules();
        }

        async function deleteSched(id) {
            if (!confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) return;
            schedules = schedules.filter(x => x.id !== id); await pushSchedules();
        }

        async function toggleSchedStatus(id, enabled) {
            const idx = schedules.findIndex(x => x.id === id);
            if (idx !== -1) { schedules[idx].enabled = enabled; await pushSchedules(); }
        }

        async function trySched(id) {
            const s = schedules.find(x => x.id === id);
            if (s) doSpeak(s.payload, 'auto', 'female');
        }

        function updateCharCount(txt) {
            document.getElementById('charCount').innerText = txt.length;
        }

        async function initSystemState() {
            try {
                // Fetch Volume
                const resVol = await fetch(`${API_BASE}/state`);
                const state = await resVol.json();
                if (state.vol !== undefined) {
                    $('volSlider').value = state.vol;
                    $('volVal').innerText = state.vol + '%';
                }

                // Fetch Chime Config
                const resChime = await fetch(`${API_BASE}/api/get_chime_config`);
                const chime = await resChime.json();
                if (chime.ok) {
                    $('chimeToggle').checked = chime.enabled;
                }

                // Fetch Relay Config
                const resRelay = await fetch(`${API_BASE}/api/get_relay_config`);
                const relay = await resRelay.json();
                if (relay.ok) {
                    $('ampToggle').checked = relay.auto_on;
                }
            } catch (e) { console.error('Init error:', e); }
        }

        window.onclick = function (e) { if (e.target == $('schedModal')) closeSchedModal(); }

        // Startup Sequence
        initSystemState();
        loadSchedules();
        // [NEW] Audition Logic
        async function auditionText(text, lang, gender) {
            if (!text) return;
            console.log("Audition:", text, lang);

            // API Preview (Edge TTS)
            try {
                const res = await fetch(`${API_BASE}/api/tts_preview`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text, lang, gender, rate: 0 })
                });

                if (!res.ok) throw new Error("Server Error");

                const blob = await res.blob();
                const url = URL.createObjectURL(blob);
                const player = $('preview-player');
                if (player) {
                    player.src = url;
                    player.onended = () => URL.revokeObjectURL(url);
                    player.play().catch(e => console.error(e));
                }
            } catch (e) {
                console.warn("EdgeTTS Preview failed, fallback to native:", e);
                // Fallback
                const u = new SpeechSynthesisUtterance(text);
                const langMap = {
                    'zh': 'zh-TW', 'en': 'en-US', 'ja': 'ja-JP', 'ko': 'ko-KR',
                    'zh-TW': 'zh-TW', 'en-US': 'en-US', 'ja-JP': 'ja-JP', 'ko-KR': 'ko-KR'
                };
                u.lang = langMap[lang] || lang;
                window.speechSynthesis.cancel();
                window.speechSynthesis.speak(u);
            }
        }

        function stopAudition() {
            window.speechSynthesis.cancel();
            const player = $('preview-player');
            if (player) {
                player.pause();
                player.currentTime = 0;
            }
        }

        function auditionMainContent() {
            const text = $('manualContent').value.trim();
            const lang = $('manualLang').value;
            const gender = $('manualGender').value;
            if (!text) return alert("è«‹è¼¸å…¥å…§å®¹");
            auditionText(text, lang, gender);
        }

        setInterval(updateNextSched, 15000);
    </script>
</body>

</html>