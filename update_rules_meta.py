
import json

RULE_FILE = "ziwei_rules.json"

def update_descriptions_and_results():
    with open(RULE_FILE, 'r', encoding='utf-8') as f:
        rules = json.load(f)

    # Simplified Mapping based on User Request
    # Format: ID -> (Category, Description, ResultText, TargetPalace, Gender)
    # Note: Logic updates not applied here, only metadata. The previous fixes handled logic.
    # We will update Description and Result Text to match the user's provided list exactly.
    
    meta_updates = {
        "L-01": ("通用", "命宮(或財帛/官祿)有「地空」或「地劫」。", "需具備一技之長，思想天馬行空，適合創作、命理。"),
        "L-02": ("通用", "命宮裡坐了一顆「地劫」星。", "一生感情或金錢至少有一次大挫敗或被詐騙。"),
        "L-03": ("通用", "命宮裡坐了一顆「地空」星。", "半空折翅，易錯失即將到手的機會 (如升官前夕)。"),
        "L-04": ("通用", "地空和地劫分別在父母宮與兄弟宮(夾命)。", "一生運勢渺茫，樣樣通樣樣鬆，恆心毅力不足。"),
        "L-05": ("通用", "命宮同時有「化權」和「化忌」。", "情緒起伏大，翻臉如翻書，易因個性不穩導致離婚。"),
        "L-06": ("通用", "命宮或父母宮有龍池、鳳閣，加紅鸞或天喜。", "長相男帥女美，為人正派且胸襟廣闊。"),
        "L-07": ("通用", "命宮同時有「龍池」和「鳳閣」。", "敗部復活，失敗後能遇到良好的翻身機會。"),
        "L-08": ("通用", "命宮同時有「紅鸞」和「天喜」。", "有人緣。(若三方四正再加昌曲：氣質出眾)。"),
        "L-09": ("通用", "紫微星和(地空或地劫)同宮。", "會有想過隱士般出家生活的念頭。"),
        "L-10": ("通用", "有壞星(忌/煞)且遇到昌曲化忌加天姚。", "心術不正，個性奸詐且愛說謊。"),
        "L-11": ("通用", "有陰煞，且遇到四煞星(羊陀火鈴)。", "易犯小人被陷害，自己也可能會去害人。"),
        "L-12": ("通用", "有祿存加天馬，且遇到貴人星(左右/魁鉞)。", "祿馬交馳逢吉，好命格。"),
        "L-13": ("通用", "三方四正有文昌化忌或文曲化忌。", "易遭遇跳票，不宜從事收受支票的生意，宜收現金。"),
        "L-14": ("通用", "有壞星(忌/煞/刑)且無左輔右弼(或單星)。", "脾氣壞，混混命。(需左右雙星同宮才可解)。"),
        "L-15": ("通用", "有空劫，且加了擎羊或化忌。", "脾氣差，好高騖遠，想得多做得少。"),
        "L-16": ("男命", "同時有化權、化忌、天刑。", "具有暴力傾向。"),
        "L-17": ("通用", "有火星，且天馬同宮或在對宮沖。", "戰馬格：極度忙碌卻不知為何而忙。"),
        "L-18": ("通用", "有天刑，且遇到孤辰或寡宿。", "容易有精神上的劈腿念頭 (不敢行動)。"),
        "L-19": ("通用", "同時有「天刑」和「擎羊」。", "個性固執，行事容易走極端。"),
        "L-20": ("男命", "坐守天機化忌，或被對宮天機化忌沖。", "極在意伴侶或他人語氣，忍久了容易爆發。"),
        "L-21": ("通用", "有(孤/寡/火/鈴)分布，且見天刑加擎羊。", "個性極端，有自殺或殺人的風險。"),
        "L-22": ("通用", "同時有「擎羊」和「力士」。", "說話直率辛辣，愛評論是非，但具備堅強毅力。"),
        "L-23": ("通用", "有巨門化權，加天刑和官符。", "極愛訴訟，動不動就告人。"),
        "L-24": ("通用", "有巨門化權，且跟擎羊同宮。", "說話霸道口氣差，不適合做為配偶對象。"),
        "L-25": ("通用", "有巨門化忌，且跟擎羊同宮。", "易造口業，吵架時會說出缺德的話。"),
        "L-26": ("通用", "有一顆「陀羅」星。", "容易輕信剛認識的人。"),
        "L-27": ("通用", "(破軍在辰戌或紫相)遇(忌/羊/姚/陰/刑)。", "可能為了利益出賣任何人。"),
        "L-28": ("通用", "只有一顆「祿存」，無其他主星。", "個性吝嗇，是一毛不拔的鐵公雞。"),
        "L-29": ("通用", "七殺加四煞星，且福德宮有廉貞化忌。", "情緒化嚴重，易有非理性行為甚至作奸犯科。"),
        "Bo-01": ("通用", "命宮和身宮在同一個位置。", "個性固執，主觀意識強。"),
        "Bo-02": ("通用", "身宮落在夫妻宮。", "易受另一半情緒影響。"),
        "Bo-03": ("通用", "身宮落在財帛宮。", "重視金錢，價值觀重物質。"),
        "Bo-04": ("通用", "身宮落在遷移宮。", "待不住家，喜外出發展。"),
        "Bo-05": ("通用", "身宮落在官祿宮。", "事業心強，無工作覺得人生無趣。"),
        "Bo-06": ("通用", "身宮落在福德宮。", "重享受，戰鬥力較弱。"),
        "B-01": ("通用", "有武曲化忌，加擎羊和天刑。", "分財產時會發生衝突，甚至訴諸法律。"),
        "B-02": ("通用", "同時有祿存和化祿 (雙祿)。", "母親經濟能力佳，且手足感情較好。"),
        "B-03": ("通用", "有兩對以上的成對星星(如左右/昌曲)。", "可能有雙胞胎兄弟姐妹。"),
        "S-01": ("女命", "廉貞星化忌或落陷。", "早婚丈夫易劈腿，或容易被不務正業的人追求。"),
        "S-02": ("通用", "有祿存或祿馬交馳 (女命逢破軍煞則凶)。", "配偶經濟狀況佳。(女命逢破軍煞：夫富但刻薄)。"),
        "S-03": ("通用", "(空劫/孤寡)加天刑，再遇煞星。", "相處時間少，一見面就吵架，易離婚。"),
        "S-04": ("通用", "有一顆「天馬」星。", "會嫁娶外地人/外國人。(煞多易離)。"),
        "S-05": ("女命", "有一顆「天鉞」星。", "有女性貴人介入，丈夫容易劈腿。"),
        "S-06": ("女命", "有化忌星 (尤忌太陰落陷)。", "性生活不協調，婚姻品質受影響。"),
        "S-07": ("女命", "同時有化權和化忌。", "丈夫只顧自己享受，無互動。"),
        "S-08": ("通用", "有化祿或者化權。", "夫妻情趣好，性生活美滿。"),
        "S-09": ("通用", "被化忌星沖(對宮)或拱照。", "夫妻容易吵架。"),
        "S-10": ("通用", "有龍池、鳳閣，加紅鸞或天喜。", "配偶長相俊美。"),
        "S-11": ("通用", "這條線上有紅鸞或天喜。", "有婚事或懷孕。(逢空劫陀羅：婚事拖延)。"),
        "S-12": ("女命", "只有一顆破軍星獨坐。", "易受夫家排擠，離婚機率極高。"),
        "S-13": ("女命", "有太陽化祿。", "丈夫百分之百會劈腿。"),
        "S-14": ("男命", "有太陽化權。", "娶悍妻，老婆強勢且會公開罵人。"),
        "S-15": ("通用", "有天刑，且遇到孤辰或寡宿。", "夫妻間無話可說，一開口就爭吵。"),
        "S-16": ("通用", "(天哭+空劫)或(男遇孤辰太陰忌)或(女遇寡宿太陽忌)。", "配偶容易早逝。"),
        "S-17": ("女命", "命宮巨門忌，且夫妻宮有寡宿/空劫/天哭。", "強烈剋夫格。"),
        "S-18": ("通用", "有火星。", "閃電結婚也容易閃電離婚。"),
        "S-19": ("通用", "有陀羅。", "婚事與離婚過程都會拖延很久。"),
        "S-20": ("通用", "紫微貪狼在酉，或是有天姚加紅鸞。", "夫妻雙方都容易有外遇。"),
        "S-21": ("女命", "武曲星在丑或未的位置。", "丈夫身材高壯。"),
        "C-01": ("女命", "宮干自化祿或忌，飛入疾厄/田宅。", "性慾強烈。(化忌更強)。"),
        "C-02": ("通用", "有七殺或擎羊。", "子女個性較叛逆。"),
        "C-03": ("通用", "有擎羊、化忌、天刑。", "子女極度叛逆，不可打罵，否則反效果嚴重。"),
        "C-04": ("男命", "有地空地劫加天姚。", "性慾強但力不從心 (早洩)。"),
        "C-05": ("通用", "有化祿或祿馬交馳。", "將小孩帶去店裡可招攬生意。"),
        "C-06": ("男命", "有陀羅星。", "性行為持久 (在本宮才算)。"),
        "C-07": ("女命", "流年宮位自化祿或自化忌。", "該年容易與有家室的男性交往。"),
        "W-01": ("通用", "(火/鈴)加貪狼，且無空劫。", "偏財運佳，有橫發機會。(忌見羊陀)。"),
        "W-02": ("通用", "宮干自化祿。", "賺錢多但開銷大，錢財左手進右手出。"),
        "W-03": ("通用", "有紅鸞或天喜。", "喜好投機行為 (如賭博、股票)。"),
        "W-04": ("通用", "有天姚和沐浴。", "賭博必輸。"),
        "W-05": ("通用", "同時有祿存和化祿 (雙祿)。", "雙祿交流，財運極佳賺大錢。"),
        "W-06": ("通用", "有地空或地劫。", "破財。(同宮或夾宮損失更重)。"),
        "W-07": ("通用", "有天機化忌。", "投資做生意易虧損，適合命理或技術服務。"),
        "W-08": ("通用", "有破軍。", "適合在人多熱鬧處 (如夜市、市場) 求財。"),
        "W-09": ("通用", "有太陽星且位置在巳或午。", "賺錢眾人皆知，表面風光。"),
        "W-10": ("通用", "有天梁化祿。", "進財容易引起紛爭，或售後服務繁瑣。"),
        "W-11": ("女命", "有貪狼、化忌、天姚、陀羅。", "缺錢時容易從事八大行業。"),
        "H-01": ("通用", "有擎羊且化忌。", "容易罹患重症 (如癌症)。"),
        "H-02": ("通用", "有一顆擎羊星。", "一生至少會經歷一次開刀手術。"),
        "H-03": ("通用", "只有一顆地空星(無其他煞)。", "能將病氣空掉，反主身體健康。"),
        "H-04": ("通用", "有很多桃花星。", "男命好色；女命主丈夫有桃花。"),
        "H-05": ("男命", "(廉貞/貪狼)化忌加(天姚/陰煞)。", "容易因縱慾過度得性病。"),
        "H-06": ("通用", "化忌加三顆煞星。", "易罹患癌症的高危險群。"),
        "T-01": ("通用", "有巨門化忌、陀羅、天刑。", "出外易有車關或口舌官司。"),
        "T-02": ("通用", "有左輔和右弼。", "出外有貴人相助。"),
        "T-03": ("通用", "有廉貞化忌和擎羊。", "嚴重車關。(加七殺：路上埋屍)。"),
        "T-04": ("通用", "有破軍加文曲(或文曲化忌)。", "出外忌靠近水域，防水厄。"),
        "F-01": ("通用", "(破軍/七殺)加(羊/陀)再加陰煞。", "極易被朋友嚴重陷害。"),
        "F-02": ("通用", "有化忌加擎羊。", "結交的朋友多為壞人。"),
        "F-03": ("通用", "流年宮位有化忌、天刑、官符。", "該年應少管朋友閒事，以免惹上官司。"),
        "Ca-01": ("通用", "有破軍加陀羅。", "適合經營無店面生意 (如夜市、路邊攤)。"),
        "Ca-02": ("通用", "有地空和地劫。", "創業應按部就班，適合技術性行業。"),
        "Ca-03": ("通用", "有巨門(或巨門化祿)。", "適合靠口才賺錢的行業 (如業務、推銷)。"),
        "Ca-04": ("通用", "有文昌或文曲化科。", "適合從事動腦、教育或寫作的職業。"),
        "Ca-05": ("通用", "有化忌加空劫。", "不適合經商，宜受薪或從事專業技術工作。"),
        "P-01": ("通用", "有化權星。", "婚後喜歡掌管家裡大小事務。"),
        "P-02": ("通用", "有空劫、擎羊、化忌。", "錢財存不住。"),
        "P-03": ("女命", "有擎羊星。", "生產時容易剖腹產。(加化忌：子宮病變)。"),
        "P-04": ("通用", "有化忌(尤忌昌曲化忌)。", "絕不可幫人作保、背書或有支票往來。"),
        "P-05": ("女命", "流年入子田線且有地空地劫。", "容易懷孕，但易流產。"),
        "P-06": ("通用", "有一顆陰煞星。", "建議家中供奉菩薩金身以保家運。"),
        "P-07": ("通用", "在四馬地(寅申巳亥)自化祿/忌，且財帛有咸池。", "不論男女都屬於敗家格局。"),
        "Fo-01": ("通用", "(福德天同+命宮天梁) 或 (反之)。", "不論男女一旦變胖就會非常懶惰。"),
        "Fo-02": ("通用", "有孤辰、寡宿、天姚。", "內心空虛，若遇天姚易發生一夜情。"),
        "Fo-03": ("女命", "有七殺、天姚，遇到煞星。", "個性現實，容易見異思遷拋棄現有伴侶。"),
        "Fo-04": ("通用", "天機化忌 (或落陷加陀羅)。", "易有憂鬱症或自殺傾向。"),
        "Fo-05": ("通用", "天相和天姚同宮。", "容易因沾染毒品而亡。"),
        "Pa-01": ("通用", "有化忌加擎羊。", "與父母緣分淡薄。"),
        "Pa-02": ("通用", "擎羊、天刑、火鈴聚會且無吉星。", "與父親關係惡劣如仇人。"),
        "Pa-03": ("通用", "七殺遇到(三顆煞星)或(化忌加兩顆煞星)。", "父母有刑剋或早逝。"),
        "X-01": ("男命", "太陽在子(晚上)化忌，加擎羊和天刑。", "恐怖命格：易因感情發生殺機或談判決裂。"),
        "X-02": ("通用", "任何一宮有：廉貞化忌+擎羊+天刑。", "官司與情殺的重災區。"),
        "X-03": ("通用", "任何一宮有：七殺+擎羊+天刑。", "個性極端，易有暴力衝突。"),
        "X-04": ("通用", "廉貞破軍在卯酉，加火星和空劫。", "有自殺傾向。"),
        "X-05": ("通用", "湊齊了：武曲、鈴星、陀羅、文昌。", "有投河或跳樓自殺的傾向。"),
        "X-06": ("通用", "破軍加貪狼，還有桃花星。", "有同性戀傾向。"),
        "X-07": ("女命", "昌曲拱照，且有天姚和紅鸞。", "生性風流。"),
        "X-08": ("通用", "(巨/陰/陽/同/府)之一坐命，有左右且化祿。", "屬於易胖體質。")
    }

    count = 0
    for r in rules:
        rid = r["id"]
        if rid in meta_updates:
            # user_gender = meta_updates[rid][0] # Not storing 'category' as gender in JSON, using it as logic context usually
            # But we can update description to include the string if needed.
            desc = meta_updates[rid][1]
            res_text = meta_updates[rid][2]
            
            # Update fields
            # We keep 'category' as is (e.g. 'life', 'spouse') because it's used for UI grouping or color coding rarely?
            # Actually the user provided 'Category' column like '通用', '男命' -> This is Context.
            
            # Refine description to match user input exactly
            r["description"] = f"{PALACE_NAMES_MAP.get(r['category'], r['category'])} - {desc}"
            # Or just overwrite description purely
            r["description"] = desc

            r["result"]["text"] = res_text
            count += 1

    with open(RULE_FILE, 'w', encoding='utf-8') as f:
        json.dump(rules, f, ensure_ascii=False, indent=4)
    print(f"Updated metadata for {count} rules.")

PALACE_NAMES_MAP = {
    "life": "命宮", "siblings": "兄弟", "spouse": "夫妻", "kids": "子女", 
    "wealth": "財帛", "health": "疾厄", "travel": "遷移", "friends": "奴僕", 
    "career": "官祿", "property": "田宅", "fortune": "福德", "parents": "父母"
}

if __name__ == "__main__":
    update_descriptions_and_results()
